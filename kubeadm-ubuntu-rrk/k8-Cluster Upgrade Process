1)
This lab tests your skills on upgrading a kubernetes cluster. We have a production cluster with applications running on it. Let us explore the setup first.
how many nodes are part of cluster
number of deployment
What nodes are the pods hosted on?


kubectl get nodes
 
 
 
 2)How many nodes can host workloads in this cluster?
 By running the kubectl describe node command, we can see that neither nodes have taints.

root@controlplane:~# kubectl describe nodes  controlplane | grep -i taint
Taints:             <none>
root@controlplane:~# 
root@controlplane:~# kubectl describe nodes  node01 | grep -i taint
Taints:             <none>
root@controlplane:~# 

This means that both nodes have the ability to schedule workloads on them

3)
You are tasked to upgrade the cluster.
User's accessing the applications must not be impacted. And you cannot provision new VMs. What strategy would you use to upgrade the cluster?
In order to ensure minimum downtime, upgrade the cluster one node at a time, 
while moving the workloads to another node. In the upcoming tasks you will get to practice how to do that.

4)We will be upgrading the master node first. Drain the master node of workloads and mark it UnSchedulable
Master Node: SchedulingDisabled
a)kubectl drain controlplane --ignore-daemonsets

5)Upgrade the controlplane components to exact version v1.20.0

Upgrade kubeadm tool (if not already), then the master components, and finally the kubelet.
Practice referring to the kubernetes documentation page. Note: While upgrading kubelet,
if you hit dependency issue while running the apt-get upgrade kubelet command, use the apt install kubelet=1.20.0-00 command instead


On the controlplane node, run the command run the following commands:

    apt update
    This will update the package lists from the software repository.

    apt install kubeadm=1.20.0-00
    This will install the kubeadm version 1.20

    kubeadm upgrade apply v1.20.0
    This will upgrade kubernetes controlplane. Note that this can take a few minutes.

    apt install kubelet=1.20.0-00 This will update the kubelet with the version 1.20.

    You may need to restart kubelet after it has been upgraded.
    Run: systemctl restart kubelet
    
    
    =====
    
    6)Mark the controlplane node as "Schedulable" again
    kubectl uncordon controlplane
    
    7)Next is the worker node. Drain the worker node of the workloads and mark it UnSchedulable
    kubectl drain node01 --ignore-daemonsets
    
    kubectl get pods -o wide
    
    
    7)Upgrade the worker node to the exact version v1.20.0
    
    On the node01 node, run the command run the following commands:

    If you are on the master node, run ssh node01 to go to node01

    apt update
    This will update the package lists from the software repository.

    apt install kubeadm=1.20.0-00
    This will install the kubeadm version 1.20

    kubeadm upgrade node
    This will upgrade the node01 configuration.

    apt install kubelet=1.20.0-00 This will update the kubelet with the version 1.20.

    You may need to restart kubelet after it has been upgraded.
    Run: systemctl restart kubelet

    Type exit or enter CTL + d to go back to the controlplane node.

    
    
